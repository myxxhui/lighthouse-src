import { type HMR_ACTION_TYPES } from "@utoo/pack-shared";
import { IncomingMessage } from "http";
import { Duplex } from "stream";
import { BundleOptions } from "../config/types";
import { Project, Update as TurbopackUpdate } from "./types";
export { type BuildingAction, type BuiltAction, type CompilationError, type HMR_ACTION_TYPES, HMR_ACTIONS_SENT_TO_BROWSER, type ReloadAction, type SyncAction, type TurbopackConnectedAction, type TurbopackMessageAction, } from "@utoo/pack-shared";
export interface WebpackStats {
    hash?: string;
    startTime?: number;
    endTime?: number;
    hasErrors(): boolean;
    hasWarnings(): boolean;
    toJson(options?: any): any;
    toString(options?: any): string;
}
export interface HotReloaderInterface {
    turbopackProject?: Project;
    serverStats: WebpackStats | null;
    setHmrServerError(error: Error | null): void;
    clearHmrServerError(): void;
    start(): Promise<void>;
    send(action: HMR_ACTION_TYPES): void;
    onHMR(req: IncomingMessage, socket: Duplex, head: Buffer, onUpgrade?: (client: {
        send(data: string): void;
    }) => void): void;
    buildFallbackError(): Promise<void>;
    close(): void;
}
export type ChangeSubscriptions = Map<string, Promise<AsyncIterableIterator<TurbopackResult>>>;
export type ReadyIds = Set<string>;
export type StartBuilding = (id: string, forceRebuild: boolean) => () => void;
export type ClientState = {
    hmrPayloads: Map<string, HMR_ACTION_TYPES>;
    turbopackUpdates: TurbopackUpdate[];
    subscriptions: Map<string, AsyncIterator<any>>;
};
export type SendHmr = (id: string, payload: HMR_ACTION_TYPES) => void;
export declare const FAST_REFRESH_RUNTIME_RELOAD = "Fast Refresh had to perform a full reload due to a runtime error.";
export declare function createHotReloader(bundleOptions: BundleOptions, projectPath?: string, rootPath?: string): Promise<HotReloaderInterface>;
