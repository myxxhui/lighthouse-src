"use strict";
import { Fragment, jsx, jsxs } from "react/jsx-runtime";
import { useEffect } from "react";
import { Card, Table, Tag, Statistic, Row, Col, Alert, Spin, Space } from "antd";
import { LoadingOutlined } from "@ant-design/icons";
import StatusIndicator from "@/components/StatusIndicator";
import { useAppStore } from "@/store";
const SLODashboard = () => {
  const { sloStatus, loadingSLO, errorSLO, fetchSLOStatus, useMockData } = useAppStore();
  useEffect(() => {
    fetchSLOStatus();
  }, [fetchSLOStatus]);
  const getStatusTag = (status) => {
    switch (status) {
      case "healthy":
        return /* @__PURE__ */ jsx(Tag, { color: "success", children: "\u5065\u5EB7" });
      case "warning":
        return /* @__PURE__ */ jsx(Tag, { color: "warning", children: "\u8B66\u544A" });
      case "critical":
        return /* @__PURE__ */ jsx(Tag, { color: "error", children: "\u4E25\u91CD" });
      default:
        return /* @__PURE__ */ jsx(Tag, { children: "\u672A\u77E5" });
    }
  };
  const columns = [
    {
      title: "\u670D\u52A1\u540D\u79F0",
      dataIndex: "serviceName",
      key: "serviceName",
      render: (text) => /* @__PURE__ */ jsx("strong", { children: text })
    },
    {
      title: "\u5065\u5EB7\u72B6\u6001",
      dataIndex: "status",
      key: "status",
      render: (status) => /* @__PURE__ */ jsxs(Space, { children: [
        /* @__PURE__ */ jsx(StatusIndicator, { status, showText: true }),
        getStatusTag(status)
      ] })
    },
    {
      title: "\u53EF\u7528\u6027 (%)",
      dataIndex: "uptime",
      key: "uptime",
      render: (value) => `${value.toFixed(2)}%`,
      sorter: (a, b) => a.uptime - b.uptime
    },
    {
      title: "\u54CD\u5E94\u65F6\u95F4 (ms)",
      dataIndex: "responseTime",
      key: "responseTime",
      render: (value) => value,
      sorter: (a, b) => a.responseTime - b.responseTime
    },
    {
      title: "\u9519\u8BEF\u7387 (%)",
      dataIndex: "errorRate",
      key: "errorRate",
      render: (value) => `${value.toFixed(2)}%`,
      sorter: (a, b) => a.errorRate - b.errorRate
    }
  ];
  const renderSummaryStats = () => {
    if (!sloStatus || sloStatus.length === 0) {
      return null;
    }
    const totalServices = sloStatus.length;
    const healthyServices = sloStatus.filter((s) => s.status === "healthy").length;
    const warningServices = sloStatus.filter((s) => s.status === "warning").length;
    const criticalServices = sloStatus.filter((s) => s.status === "critical").length;
    const avgUptime = sloStatus.reduce((sum, s) => sum + s.uptime, 0) / totalServices;
    const avgResponseTime = sloStatus.reduce((sum, s) => sum + s.responseTime, 0) / totalServices;
    const avgErrorRate = sloStatus.reduce((sum, s) => sum + s.errorRate, 0) / totalServices;
    return /* @__PURE__ */ jsxs(Row, { gutter: [16, 16], style: { marginBottom: 16 }, children: [
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u603B\u670D\u52A1\u6570", value: totalServices }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u5065\u5EB7\u670D\u52A1", value: healthyServices, valueStyle: { color: "#52c41a" } }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u8B66\u544A\u670D\u52A1", value: warningServices, valueStyle: { color: "#faad14" } }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(
        Statistic,
        {
          title: "\u4E25\u91CD\u670D\u52A1",
          value: criticalServices,
          valueStyle: { color: "#ff4d4f" }
        }
      ) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u5E73\u5747\u53EF\u7528\u6027", value: avgUptime.toFixed(2), suffix: "%" }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u5E73\u5747\u54CD\u5E94\u65F6\u95F4", value: Math.round(avgResponseTime), suffix: "ms" }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u5E73\u5747\u9519\u8BEF\u7387", value: avgErrorRate.toFixed(2), suffix: "%" }) }) })
    ] });
  };
  return /* @__PURE__ */ jsxs("div", { children: [
    /* @__PURE__ */ jsx("h2", { children: "SLO\u5065\u5EB7\u76D1\u63A7" }),
    useMockData && /* @__PURE__ */ jsx(Alert, { message: "\u5F53\u524D\u4F7F\u7528Mock\u6570\u636E", type: "info", style: { marginBottom: 16 } }),
    loadingSLO ? /* @__PURE__ */ jsxs("div", { style: { textAlign: "center", padding: "40px" }, children: [
      /* @__PURE__ */ jsx(Spin, { indicator: /* @__PURE__ */ jsx(LoadingOutlined, { spin: true }) }),
      /* @__PURE__ */ jsx("p", { children: "\u52A0\u8F7DSLO\u72B6\u6001\u4E2D..." })
    ] }) : errorSLO ? /* @__PURE__ */ jsx(
      Alert,
      {
        message: "\u52A0\u8F7DSLO\u72B6\u6001\u5931\u8D25",
        description: errorSLO,
        type: "error",
        showIcon: true,
        style: { marginBottom: 16 }
      }
    ) : /* @__PURE__ */ jsxs(Fragment, { children: [
      renderSummaryStats(),
      /* @__PURE__ */ jsx(Card, { title: "\u670D\u52A1SLO\u8BE6\u60C5", children: sloStatus?.length ? /* @__PURE__ */ jsx(
        Table,
        {
          dataSource: sloStatus,
          columns,
          rowKey: "serviceName",
          pagination: {
            pageSize: 10,
            showSizeChanger: true,
            pageSizeOptions: ["10", "20", "50"]
          }
        }
      ) : /* @__PURE__ */ jsx("div", { style: { textAlign: "center", padding: "20px" }, children: "\u6682\u65E0SLO\u6570\u636E" }) })
    ] })
  ] });
};
export default SLODashboard;
