"use strict";
import { jsx, jsxs } from "react/jsx-runtime";
import { useEffect } from "react";
import { useNavigate } from "umi";
import { Card, Row, Col, Statistic, Switch, Space, Alert } from "antd";
import { LoadingOutlined } from "@ant-design/icons";
import CostTable from "@/components/CostTable";
import EfficiencyChart from "@/components/EfficiencyChart";
import { useAppStore } from "@/store";
const CostOverviewPage = () => {
  const navigate = useNavigate();
  const {
    globalCostMetrics,
    namespaceCosts,
    loadingGlobalMetrics,
    loadingNamespaceCosts,
    errorGlobalMetrics,
    errorNamespaceCosts,
    useMockData,
    fetchGlobalCostMetrics,
    fetchNamespaceCosts,
    setUseMockData
  } = useAppStore();
  useEffect(() => {
    fetchGlobalCostMetrics();
    fetchNamespaceCosts();
  }, [fetchGlobalCostMetrics, fetchNamespaceCosts]);
  const handleRowClick = (record) => {
    navigate(`/DrilldownPage?type=namespace&id=${record.namespace}`);
  };
  const renderGlobalMetrics = () => {
    if (loadingGlobalMetrics) {
      return /* @__PURE__ */ jsx(Card, { loading: true, children: /* @__PURE__ */ jsx(LoadingOutlined, {}) });
    }
    if (errorGlobalMetrics) {
      return /* @__PURE__ */ jsx(Alert, { message: "\u52A0\u8F7D\u5168\u5C40\u6307\u6807\u5931\u8D25", description: errorGlobalMetrics, type: "error", showIcon: true });
    }
    if (!globalCostMetrics) {
      return /* @__PURE__ */ jsx(Card, { children: "\u6682\u65E0\u6570\u636E" });
    }
    return /* @__PURE__ */ jsxs(Row, { gutter: [16, 16], children: [
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(
        Statistic,
        {
          title: "\u603B\u8D26\u5355\u6210\u672C",
          value: globalCostMetrics.totalBillableCost,
          prefix: "\xA5",
          formatter: (value) => Number(value).toLocaleString()
        }
      ) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(
        Statistic,
        {
          title: "\u53EF\u4F18\u5316\u7A7A\u95F4",
          value: globalCostMetrics.totalOptimizableSpace,
          prefix: "\xA5",
          formatter: (value) => Number(value).toLocaleString()
        }
      ) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(Statistic, { title: "\u5168\u5C40\u6548\u7387\u5206", value: globalCostMetrics.globalEfficiency, suffix: "%" }) }) }),
      /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 6, children: /* @__PURE__ */ jsx(Card, { children: /* @__PURE__ */ jsx(
        "div",
        {
          style: {
            display: "flex",
            justifyContent: "center",
            alignItems: "center",
            height: "100%"
          },
          children: /* @__PURE__ */ jsx(EfficiencyChart, { efficiency: globalCostMetrics.globalEfficiency, size: 80 })
        }
      ) }) })
    ] });
  };
  const renderDomainBreakdown = () => {
    if (!globalCostMetrics?.domainBreakdown?.length) {
      return null;
    }
    return /* @__PURE__ */ jsx(Card, { title: "\u9886\u57DF\u6210\u672C\u5206\u89E3", style: { marginTop: 16 }, children: /* @__PURE__ */ jsx(Row, { gutter: [16, 16], children: globalCostMetrics.domainBreakdown.map((domain, index) => /* @__PURE__ */ jsx(Col, { xs: 24, sm: 12, md: 8, lg: 6, children: /* @__PURE__ */ jsx(Card, { size: "small", children: /* @__PURE__ */ jsx(
      Statistic,
      {
        title: domain.domain,
        value: domain.cost,
        prefix: "\xA5",
        formatter: (value) => Number(value).toLocaleString(),
        suffix: /* @__PURE__ */ jsx("div", { style: { marginTop: 8 }, children: /* @__PURE__ */ jsxs("small", { children: [
          "\u6548\u7387: ",
          domain.efficiency,
          "%"
        ] }) })
      }
    ) }) }, index)) }) });
  };
  return /* @__PURE__ */ jsxs("div", { children: [
    /* @__PURE__ */ jsxs(
      "div",
      {
        style: {
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 16
        },
        children: [
          /* @__PURE__ */ jsx("h2", { children: "\u5168\u57DF\u6210\u672C\u900F\u89C6" }),
          /* @__PURE__ */ jsxs(Space, { children: [
            /* @__PURE__ */ jsx("span", { children: "\u4F7F\u7528Mock\u6570\u636E" }),
            /* @__PURE__ */ jsx(
              Switch,
              {
                checked: useMockData,
                onChange: setUseMockData,
                checkedChildren: "\u662F",
                unCheckedChildren: "\u5426"
              }
            )
          ] })
        ]
      }
    ),
    renderGlobalMetrics(),
    renderDomainBreakdown(),
    /* @__PURE__ */ jsx(Card, { title: "\u547D\u540D\u7A7A\u95F4\u6210\u672C\u660E\u7EC6", style: { marginTop: 16 }, children: loadingNamespaceCosts ? /* @__PURE__ */ jsxs("div", { style: { textAlign: "center", padding: "20px" }, children: [
      /* @__PURE__ */ jsx(LoadingOutlined, { spin: true }),
      " \u52A0\u8F7D\u4E2D..."
    ] }) : errorNamespaceCosts ? /* @__PURE__ */ jsx(
      Alert,
      {
        message: "\u52A0\u8F7D\u547D\u540D\u7A7A\u95F4\u6210\u672C\u5931\u8D25",
        description: errorNamespaceCosts,
        type: "error",
        showIcon: true
      }
    ) : namespaceCosts?.length ? /* @__PURE__ */ jsx(CostTable, { data: namespaceCosts, onRowClick: handleRowClick }) : /* @__PURE__ */ jsx("div", { style: { textAlign: "center", padding: "20px" }, children: "\u6682\u65E0\u547D\u540D\u7A7A\u95F4\u6570\u636E" }) })
  ] });
};
export default CostOverviewPage;
