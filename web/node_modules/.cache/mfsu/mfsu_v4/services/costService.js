"use strict";
import { apiClient } from "@/services/api";
import {
  adaptGlobalCostToCostMetrics,
  adaptNamespacesToNamespaceCosts
} from "@/adapters/apiAdapter";
const COST_API_PREFIX = "/v1/cost";
export const costService = {
  // 获取全域成本透视数据（通过适配层转换为前端类型）
  async getGlobalCostMetrics() {
    try {
      const response = await apiClient.get(`${COST_API_PREFIX}/global`);
      return adaptGlobalCostToCostMetrics(response.data);
    } catch (error) {
      console.error("Failed to fetch global cost metrics:", error);
      throw error;
    }
  },
  // 获取Namespace级别成本数据（通过适配层转换为前端类型）
  async getNamespaceCosts() {
    try {
      const response = await apiClient.get(
        `${COST_API_PREFIX}/namespaces`
      );
      return adaptNamespacesToNamespaceCosts(response.data);
    } catch (error) {
      console.error("Failed to fetch namespace costs:", error);
      throw error;
    }
  },
  // 获取钻取数据
  async getDrilldownData(type, id) {
    try {
      const response = await apiClient.get(
        `${COST_API_PREFIX}/drilldown/${type}/${id}`
      );
      return response.data;
    } catch (error) {
      console.error(`Failed to fetch drilldown data for ${type} ${id}:`, error);
      throw error;
    }
  },
  // 获取SLO状态 (GET /api/v1/slo/health)
  async getSLOStatus() {
    try {
      const response = await apiClient.get("/v1/slo/health");
      const data = response.data;
      return Array.isArray(data) ? data : data?.items ?? [];
    } catch (error) {
      console.error("Failed to fetch SLO status:", error);
      throw error;
    }
  },
  // 获取ROI趋势数据 (GET /api/v1/roi/dashboard)
  async getROITrends() {
    try {
      const response = await apiClient.get("/v1/roi/dashboard");
      const data = response.data;
      return Array.isArray(data) ? data : data?.trends ?? [];
    } catch (error) {
      console.error("Failed to fetch ROI trends:", error);
      throw error;
    }
  }
};
