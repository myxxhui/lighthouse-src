"use strict";(self.webpackChunklighthouse_web=self.webpackChunklighthouse_web||[]).push([[381],{71239:function(ae,Z,n){var te=n(67294),M=n(29009),L=n(73604),O=n(46208),S=n(43815),v=n(26050),o=n(85893),K=function(l){var f=l.efficiency,w=l.size,C=w===void 0?120:w,N=l.showLabel,$=N===void 0?!0:N,I=[{name:"\u6548\u7387",value:f},{name:"\u53EF\u4F18\u5316\u7A7A\u95F4",value:100-f}],R=["#52c41a","#faad14"],V=function(a){var e=a.cx,G=a.cy,z=a.midAngle,b=a.innerRadius,J=a.outerRadius,T=a.percent,U=b+(J-b)*.5,Q=e+U*Math.cos(-z*(Math.PI/180)),X=G+U*Math.sin(-z*(Math.PI/180));return(0,o.jsx)("text",{x:Q,y:X,fill:"white",textAnchor:"middle",dominantBaseline:"central",fontSize:14,fontWeight:"bold",children:"".concat((T*100).toFixed(0),"%")})};return(0,o.jsx)("div",{style:{width:C,height:C},children:(0,o.jsx)(M.h,{width:"100%",height:"100%",children:(0,o.jsxs)(L.u,{children:[(0,o.jsx)(O.b,{data:I,cx:"50%",cy:"50%",innerRadius:C*.3,outerRadius:C*.5,paddingAngle:2,dataKey:"value",labelLine:!1,label:$?V:void 0,children:I.map(function(k,a){return(0,o.jsx)(S.b,{fill:R[a%R.length]},"cell-".concat(a))})}),(0,o.jsx)(v.u,{formatter:function(a){return["".concat(a,"%"),""]}})]})})})};Z.Z=K},75305:function(ae,Z,n){n.r(Z),n.d(Z,{default:function(){return X}});var te=n(5574),M=n.n(te),L=n(67294),O=n(74330),S=n(40056),v=n(75398),o=n(4393),K=n(92783),P=n(98081),l=n(26412),f=n(38703),w=n(50888),C=n(20057),N=n(13854),$=n(19632),I=n.n($),R=n(85673),V=n(82826),k=n(73403),a=n(12021),e=n(85893),G={compute:"\u7B97\u529B",storage:"\u5B58\u50A8",network:"\u7F51\u7EDC"},z=function(x){var g,c=x.onBack,W=x.onHome,F=x.dimension,p=(0,a.q)(),i=p.drilldownPath,t=p.clearDrilldownPath,Y=p.selectedDimension,B=F!=null?F:Y,h=function(){c?c():i.length>0&&t()},q=function(){W?W():t()},y={namespace:"\u547D\u540D\u7A7A\u95F4",node:"\u8282\u70B9",workload:"\u5DE5\u4F5C\u8D1F\u8F7D",pod:"Pod",storage_class:"\u5B58\u50A8\u7C7B",pvc:"PVC",volume:"\u5377",service:"\u670D\u52A1",ingress:"Ingress",lb:"\u8D1F\u8F7D\u5747\u8861",traffic_type:"\u6D41\u91CF\u7C7B\u578B"},E=[].concat(I()(B?[{title:(g=G[B])!==null&&g!==void 0?g:B,key:"dim"}]:[]),I()(i.map(function(j,H){var A,m=j.split(":"),d=M()(m,2),u=d[0],D=d[1],_=(A=y[u])!==null&&A!==void 0?A:u;return{title:"".concat(_,": ").concat(D),key:"path-".concat(H)}})));return(0,e.jsxs)(P.Z,{size:"middle",style:{marginBottom:16},children:[(0,e.jsx)(v.ZP,{icon:(0,e.jsx)(V.Z,{}),onClick:h,disabled:i.length===0,children:"\u8FD4\u56DE"}),(0,e.jsx)(v.ZP,{icon:(0,e.jsx)(k.Z,{}),onClick:q,children:"\u9996\u9875"}),E.length>0&&(0,e.jsx)(R.Z,{items:E})]})},b=z,J=n(71239),T=n(68790),U=[{value:"compute",label:"\u7B97\u529B"},{value:"storage",label:"\u5B58\u50A8"},{value:"network",label:"\u7F51\u7EDC"}],Q=function(){var x,g,c=(0,C.s0)(),W=(0,N.lr)(),F=M()(W,1),p=F[0],i=(0,a.q)(),t=i.currentDrilldownItem,Y=i.loadingDrilldown,B=i.errorDrilldown,h=i.namespaceCosts,q=i.loadingNamespaceCosts,y=i.selectedDimension,E=i.setSelectedDimension,j=i.fetchDrilldownData,H=i.fetchNamespaceCosts,A=i.clearDrilldownPath,m=(x=p.get("type"))!==null&&x!==void 0?x:void 0,d=(g=p.get("id"))!==null&&g!==void 0?g:void 0,u=p.get("dimension"),D=u&&["compute","storage","network"].includes(u)?u:y;(0,L.useEffect)(function(){u&&u!==y&&E(u)},[u,y,E]),(0,L.useEffect)(function(){return m&&d?j(m,d,D):H(),function(){A()}},[m,d,D,j,H,A]);var _=function(){c(-1)},se=function(){c("/")},oe=function(){if(Y)return(0,e.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,e.jsx)(O.Z,{indicator:(0,e.jsx)(w.Z,{spin:!0})}),(0,e.jsx)("p",{children:"\u52A0\u8F7D\u4E2D..."})]});if(B)return(0,e.jsx)(S.Z,{message:"\u52A0\u8F7D\u94BB\u53D6\u6570\u636E\u5931\u8D25",description:B,type:"error",showIcon:!0,action:(0,e.jsx)(v.ZP,{type:"primary",onClick:function(){return m&&d&&j(m,d,D)},children:"\u91CD\u8BD5"})});if(!m||!d)return q&&!(h!=null&&h.length)?(0,e.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,e.jsx)(O.Z,{indicator:(0,e.jsx)(w.Z,{spin:!0})}),(0,e.jsx)("p",{children:"\u52A0\u8F7D\u547D\u540D\u7A7A\u95F4..."})]}):h&&h.length>0?(0,e.jsxs)(o.Z,{title:"\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u5F00\u59CB\u4E0B\u94BB",children:[(0,e.jsx)("p",{style:{marginBottom:12,color:"#666"},children:"\u9009\u62E9\u8D44\u6E90\u7EF4\u5EA6\u540E\uFF0C\u4ECE\u4E0B\u65B9\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u67E5\u770B\u6210\u672C\u9010\u5C42\u4E0B\u94BB\uFF0C\u6216\u524D\u5F80\u5168\u57DF\u6210\u672C\u900F\u89C6\u67E5\u770B\u603B\u89C8\u3002"}),(0,e.jsxs)("div",{style:{marginBottom:16},children:[(0,e.jsx)("span",{style:{marginRight:8},children:"\u8D44\u6E90\u7EF4\u5EA6\uFF1A"}),(0,e.jsx)(K.Z,{options:U,value:y,onChange:function(s){return E(s)}})]}),(0,e.jsx)(P.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:h.map(function(r){return(0,e.jsx)(o.Z,{hoverable:!0,onClick:function(){return c("/DrilldownPage?dimension=".concat(y,"&type=namespace&id=").concat(encodeURIComponent(r.namespace)))},style:{marginBottom:0},children:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsx)("strong",{children:r.namespace}),(0,e.jsxs)("span",{children:["\u6210\u672C \xA5",r.cost.toLocaleString()," \xB7 \u6548\u7387 ",r.efficiency,"%"]})]})},r.namespace)})}),(0,e.jsx)("div",{style:{marginTop:16},children:(0,e.jsx)(v.ZP,{type:"primary",onClick:function(){return c("/CostOverviewPage")},children:"\u524D\u5F80\u5168\u57DF\u6210\u672C\u900F\u89C6"})})]}):(0,e.jsx)(S.Z,{message:"\u8BF7\u9009\u62E9\u4E0B\u94BB\u8D77\u70B9",description:"\u8BF7\u4ECE\u300C\u5168\u57DF\u6210\u672C\u900F\u89C6\u300D\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u5F00\u59CB\u4E0B\u94BB\uFF0C\u6216\u7B49\u5F85\u6570\u636E\u52A0\u8F7D\u540E\u5728\u6B64\u9009\u62E9\u3002",type:"info",showIcon:!0,action:(0,e.jsx)(v.ZP,{type:"primary",onClick:function(){return c("/CostOverviewPage")},children:"\u524D\u5F80\u5168\u57DF\u6210\u672C\u900F\u89C6"})});if(!t)return(0,e.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:(0,e.jsx)("p",{children:"\u6682\u65E0\u6570\u636E"})});var ee=function(s){switch(s){case"namespace":return"\u547D\u540D\u7A7A\u95F4";case"node":return"\u8282\u70B9";case"workload":return"\u5DE5\u4F5C\u8D1F\u8F7D";case"pod":return"Pod";case"storage_class":return"\u5B58\u50A8\u7C7B";case"pvc":return"PVC";case"volume":return"\u5377";case"service":return"\u670D\u52A1";case"ingress":return"Ingress";case"lb":return"\u8D1F\u8F7D\u5747\u8861";case"traffic_type":return"\u6D41\u91CF\u7C7B\u578B";default:return s}},ne="healthy";return t.efficiency<50?ne="critical":t.efficiency<70&&(ne="warning"),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(o.Z,{title:"".concat(ee(t.type),": ").concat(t.name),children:[(0,e.jsxs)(l.Z,{column:{xs:1,sm:2,md:3},bordered:!0,children:[(0,e.jsx)(l.Z.Item,{label:"ID",children:t.id}),(0,e.jsx)(l.Z.Item,{label:"\u7C7B\u578B",children:ee(t.type)}),(0,e.jsx)(l.Z.Item,{label:"\u6210\u672C (\xA5)",children:t.cost.toLocaleString()}),(0,e.jsx)(l.Z.Item,{label:"\u53EF\u4F18\u5316\u7A7A\u95F4 (\xA5)",children:t.optimizableSpace.toLocaleString()}),(0,e.jsx)(l.Z.Item,{label:"\u6548\u7387\u5206",children:(0,e.jsxs)(P.Z,{children:[(0,e.jsx)(J.Z,{efficiency:t.efficiency,size:40,showLabel:!1}),(0,e.jsxs)("span",{children:[t.efficiency,"%"]})]})}),(0,e.jsx)(l.Z.Item,{label:"\u5065\u5EB7\u72B6\u6001",children:(0,e.jsx)(T.Z,{status:ne,showText:!0})})]}),t.costBreakdown&&(0,e.jsxs)("div",{style:{marginTop:16},children:[(0,e.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:"\u6210\u672C\u6784\u6210"}),(0,e.jsxs)(P.Z,{direction:"vertical",style:{width:"100%"},size:"small",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{style:{display:"inline-block",width:72},children:"\u7B97\u529B(CPU)"}),(0,e.jsx)(f.Z,{percent:Math.min(100,Math.round(t.costBreakdown.cpu/t.cost*100)),size:"small",showInfo:!0,format:function(s){return"\xA5".concat(t.costBreakdown.cpu.toLocaleString()," (").concat(s,"%)")}})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{style:{display:"inline-block",width:72},children:"\u5185\u5B58"}),(0,e.jsx)(f.Z,{percent:Math.min(100,Math.round(t.costBreakdown.memory/t.cost*100)),size:"small",showInfo:!0,format:function(s){return"\xA5".concat(t.costBreakdown.memory.toLocaleString()," (").concat(s,"%)")}})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{style:{display:"inline-block",width:72},children:"\u5B58\u50A8"}),(0,e.jsx)(f.Z,{percent:Math.min(100,Math.round(t.costBreakdown.storage/t.cost*100)),size:"small",showInfo:!0,format:function(s){return"\xA5".concat(t.costBreakdown.storage.toLocaleString()," (").concat(s,"%)")}})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{style:{display:"inline-block",width:72},children:"\u7F51\u7EDC"}),(0,e.jsx)(f.Z,{percent:Math.min(100,Math.round(t.costBreakdown.network/t.cost*100)),size:"small",showInfo:!0,format:function(s){return"\xA5".concat(t.costBreakdown.network.toLocaleString()," (").concat(s,"%)")}})]})]})]})]}),t.children&&t.children.length>0&&(0,e.jsx)(o.Z,{title:"\u5B50\u8D44\u6E90",style:{marginTop:16},children:t.children.map(function(r){return(0,e.jsx)(o.Z,{style:{marginBottom:8},hoverable:!0,onClick:function(){c("/DrilldownPage?dimension=".concat(D,"&type=").concat(encodeURIComponent(r.type),"&id=").concat(encodeURIComponent(r.id)))},children:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("strong",{children:[ee(r.type),": ",r.name]}),(0,e.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:["\u6210\u672C: \xA5",r.cost.toLocaleString()," | \u6548\u7387: ",r.efficiency,"%"]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(T.Z,{status:r.efficiency<50?"critical":r.efficiency<70?"warning":"healthy"})})]})},r.id)})})]})};return(0,e.jsxs)("div",{children:[(0,e.jsx)(b,{onBack:_,onHome:se,dimension:D}),oe()]})},X=Q}}]);
