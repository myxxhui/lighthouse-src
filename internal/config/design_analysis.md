# Lighthouse配置框架设计分析

## 现有问题分析
1. **三级存储架构缺失**：当前只有单一的DatabaseConfig，没有区分PostgreSQL控制平面、ClickHouse证据平面、Prometheus信号平面
2. **ClickHouse配置缺失**：证据平面存储需要单独的连接配置
3. **分析引擎配置缺失**：Analysis Engine服务的地址和认证配置
4. **数据保留策略缺失**：故障快照、日志等的保留时间配置
5. **安全配置不完整**：RBAC、权限限制、熔断策略等

## 三级存储架构配置需求

### 1. PostgreSQL控制平面 (Control Plane)
- **用途**：存储元数据、配置、快照、日报
- **配置项**：连接信息、连接池、超时、SSL、迁移配置

### 2. ClickHouse证据平面 (Evidence Plane)
- **用途**：存储日志、Trace、采样数据
- **配置项**：连接信息、集群配置、压缩策略、保留策略

### 3. Prometheus信号平面 (Signal Plane)
- **用途**：实时指标、SLO状态查询
- **配置项**：地址、查询超时、认证、查询限制

## 业务模块配置需求

### 1. 成本计算模块
- CPU/内存单价
- 计算间隔
- 聚合级别配置
- 效率评级阈值

### 2. SLO诊断模块
- SLO阈值（可用性、延迟）
- 快照触发条件
- 证据链收集配置
- 保留时间策略

### 3. ROI追踪模块
- 基线配置
- 追踪频率
- 价值量化指标

## 安全性配置需求
1. **敏感字段标记**：密码、令牌等必须从环境变量加载
2. **RBAC配置**：K8s权限设置
3. **资源限制**：Lighthouse自身资源限制
4. **查询熔断**：防止监控搞挂集群

## 多环境支持
- dev/staging/prod环境标识
- 环境特定的配置覆盖
- 环境特定的验证规则

## 配置加载优先级
1. 环境变量 (最高优先级)
2. 环境特定配置文件 (config.dev.yaml等)
3. 基础配置文件 (config.yaml)
4. 默认值 (最低优先级)